prompts:
  - id: extract-legislation-from-md
    name: extract-legislation-from-md
    version: 0.1.1
    created: 2025-01-31
    authors: ["<autor>"]
    description: "Extrai referências a normas e dispositivos de um texto. Saída em protocolo de linhas N/R."
    tags: ["legislação", "parser", "line-protocol"]
    model:
      provider: mistral
      name: mistral-text
      temperature: 0
      max_tokens: 800
    role: system
    system_prompt: |-
      Responda APENAS no formato de linhas abaixo, sem JSON, sem markdown, sem texto extra.

      Formato:
      N|<id>|<jur>|<tipo>|<ano>|<desc>
      R|<art>|<caput?>|<inc?>|<par?>|<par_unico?>|<letra?>

      Omitir campos vazios no fim da linha.

      Regras:
      - Agrupar por norma; deduplicar normas e dispositivos.
      - articleNumber: inteiro de “art./artigo”.
      - isCaput: 1 se “caput” OU se apenas “art. X” (sem inciso/parágrafo/alínea).
      - incisoNumber: romano → inteiro; ausente vazio.
      - paragraphNumber: “§ nº” → inteiro; ausente vazio.
      - isParagraphSingle: 1 se “parágrafo único”.
      - letterCode: “alínea a / a)” → “a”; ausente vazio.
      - normIdentifier: CF-1988; EC-n-ano; LC-n-ano; LEI-n-ano; DECRETO-n-ano (remover ponto do número).
      - normYear: inteiro; ausente 0.
      - normDescription: nome curto se explícito; senão vazio.
      - jurisdictionLevel: inferir; senão unknown.
    user_prompt: |-
      Extraia todas as normas e dispositivos do texto abaixo e responda somente nas linhas N/R conforme o formato especificado.

      {{texto}}
    output:
      type: line_protocol
      prefixes: ["N", "R"]
      delimiter: "|"
      trim_trailing_empty_fields: true
    schema:
      N: [id, jurisdiction, type, year, description]
      R: [article, isCaput, inciso, paragraph, isParagraphSingle, letterCode]
    normalization:
      normalize_identifier: "remover pontos do número (ex: 9.099 → 9099)"
      roman_to_int: "II/IV → 2/4"
      paragraph_symbol: "§ 2º → 2"
      caput_detection: "caput OR 'art. X' sem complemento → isCaput=1"
      dedupe: "agrupar normas; deduplicar dispositivos"
    examples:
      - name: CF simples
        input: "Art. 5º da CF/1988. Art. 7, inc. IV."
        output: |
          N|CF-1988|federal|CF|1988|Constituição Federal
          R|5|1
          R|7||4
      - name: Lei com inciso, parágrafo e alínea
        input: "Art. 12, inc. II, § 2º, alínea b da Lei 9.099/1995."
        output: |
          N|LEI-9099-1995|unknown|LEI|1995|
          R|12||2|2||b
    tests:
      - id: caput_only
        input: "Art. 10."
        expected:
          - "N|unknown|unknown|unknown|0|"
          - "R|10|1"
      - id: roman_inciso
        input: "Art. 7, inciso IV da CF/1988"
        expected:
          - "N|CF-1988|federal|CF|1988|Constituição Federal"
          - "R|7||4"
    metadata:
      recommended_parser: "scripts/parsers/legislation_parser.py"
      validation_script: "tests/test_prompts_extract_legislation.py"