{% extends "base.html" %}
{% block content %}
  <section class="panel">
    <div class="panel-header">
      <h1>Ministro: {{ minister_name }}</h1>
      <span class="chip">Analitico</span>
    </div>
    <p class="panel-copy">
      Indicadores consolidados e rankings de referencias vinculadas ao ministro.
    </p>
    <div class="actions">
      <a class="secondary" href="{{ url_for('ministros', **filter_params_no_minister) }}">Voltar aos ministros</a>
    </div>
  </section>

  <section class="stats-grid">
    <article class="panel stat-card">
      <span class="stat-label">Total de processos</span>
      <strong class="stat-value">{{ total_processes }}</strong>
    </article>
    <article class="panel stat-card">
      <span class="stat-label">Total de relatorias</span>
      <strong class="stat-value">{{ total_relatorias }}</strong>
    </article>
    <article class="panel stat-card">
      <span class="stat-label">Total de citacoes recebidas</span>
      <strong class="stat-value">
        <a href="{{ url_for('doutrina', minister=minister_name) }}">Doutrinas citadas ({{ total_citations }})</a>
      </strong>
    </article>
  </section>

  <section class="panel">
    <div class="panel-header">
      <h2>Distribuicao por decisao final</h2>
    </div>
    {% if decision_distribution %}
      <table>
        <thead>
          <tr>
            <th>Decisao</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          {% for row in decision_distribution %}
            <tr>
              <td>{{ row.label }}</td>
              <td>{{ row.total }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="empty">Sem dados de decisao para os filtros atuais.</p>
    {% endif %}
  </section>

  <section class="grid">
    <article class="panel">
      <div class="panel-header">
        <h2>Top 5 - Doutrina</h2>
      </div>
      {% if top_doctrine %}
        <table>
          <thead>
            <tr>
              <th>Autor</th>
              <th>Total de citacoes</th>
            </tr>
          </thead>
          <tbody>
          {% for row in top_doctrine %}
            <tr>
              <td>
                <a href="{{ url_for('doutrina_detail', kind='author', value=row.label) }}">{{ row.label }}</a>
              </td>
              <td>{{ row.total }}</td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="empty">Sem citacoes doutrinarias para os filtros atuais.</p>
      {% endif %}
    </article>

    <article class="panel">
      <div class="panel-header">
        <h2>Top 5 - Normas e acordaos</h2>
      </div>
      {% if top_norms %}
        <table>
          <thead>
            <tr>
              <th>Referencia</th>
              <th>Total de citacoes</th>
            </tr>
          </thead>
          <tbody>
            {% for row in top_norms %}
              <tr>
                <td>{{ row.label }}</td>
                <td>{{ row.total }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="empty">Sem referencias normativas ou jurisprudenciais para os filtros atuais.</p>
      {% endif %}
    </article>

    <article class="panel">
      <div class="panel-header">
        <h2>Top 5 - Legislacoes citadas</h2>
      </div>
      {% if top_legislation %}
        <table>
          <thead>
            <tr>
              <th>Norma</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            {% for row in top_legislation %}
              <tr>
                <td>
                  {% if row.description and row.description != row.identifier %}
                    {{ row.identifier }} â€” {{ row.description }}
                  {% else %}
                    {{ row.identifier }}
                  {% endif %}
                </td>
                <td>{{ row.total }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="empty">Sem referencias legislativas para os filtros atuais.</p>
      {% endif %}
    </article>
  </section>

  <section class="panel">
    <div class="panel-header">
      <h2>Processos em que foi relator</h2>
      <span class="chip">{{ relatoria_cases|length }} processos</span>
    </div>
    {% if relatoria_cases %}
      <table class="data-table">
        <thead>
          <tr>
            <th>Titulo do caso</th>
            <th>Processo</th>
            <th>Decisao</th>
          </tr>
        </thead>
        <tbody>
          {% for row in relatoria_cases %}
            <tr>
              <td>
                {% if row.stf_id %}
                  <a href="{{ url_for('processos_detail', process_id=row.stf_id) }}">{{ row.case_title }}</a>
                {% else %}
                  {{ row.case_title }}
                {% endif %}
              </td>
              <td>{{ row.process_label }}</td>
              <td>{{ row.decision_final }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="empty">Nenhum processo encontrado para este ministro.</p>
    {% endif %}
  </section>
{% endblock %}
